server:
  # Server configuration
  port: 3000

# To proxy requests: http://localhost:3000/https://httpbin.org/anything
# Everything after the first slash becomes the upstream URL

logging:
  # Default behavior if no rules match
  default: false

  # Rules for what to log, processed in order
  rules:
    - name: "Log API requests with timeout"
      match_conditions:
        # All conditions in a rule must match to log
        path:
          # Regex patterns for path matching
          patterns:
            - "httpbin.org.*"
        methods:
          - "POST"
          - "PUT"
        headers:
          # Required headers and their values (regex)
          "content-type": "application/json.*"
      capture:
        # What to capture in logs when rule matches
        headers:
          - "content-type"
          - "user-agent"
        body: true
        method: true
        path: true
        timing: true
      timeout: 30s  # 30 second timeout for this rule

    - name: "Log health checks"
      match_conditions:
        path:
          patterns:
            - "^/health$"
      capture:
        timing: true
        method: true
      # No timeout = unlimited

    - name: "Local Test"
      match_conditions:
        path:
          patterns:
            - ".*"
      capture:
        timing: true
        method: true
        path: true
        headers:
          - "content-type"
          - "user-agent"
        body: true
      # No timeout = unlimited (default)

drop:
  # Default behavior if no rules match
  default: false

  # Rules for what to drop, processed in order
  rules:
    - name: "Drop deprecated API calls"
      match_conditions:
        path:
          patterns:
            - "/api/v1/deprecated.*"
      response:
        status_code: 410
        body: "This API endpoint has been deprecated and is no longer supported."

    - name: "Drop unauthorized requests"
      match_conditions:
        headers:
          "authorization": ".*"
        path:
          patterns:
            - "/admin.*"
      response:
        status_code: 403
        body: "Access denied."

    - name: "Drop requests with malicious scripts"
      match_conditions:
        body:
          patterns:
            - "<script>.*</script>"
            - "javascript:"
      response:
        status_code: 400
        body: "Malicious content detected in request body."

response_logging:
  # Default behavior if no rules match
  default: false

  # Rules for what responses to log, processed in order
  rules:
    - name: "Log error responses"
      match_conditions:
        # Log all 4xx and 5xx responses
        status_codes:
          - 400
          - 401
          - 403
          - 404
          - 500
          - 502
          - 503
      capture:
        # What to capture in logs when rule matches
        headers:
          - "content-type"
          - "x-request-id"
        status_code: true
        body: true
        method: true
        path: true
        timing: true
